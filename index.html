<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Expert PCB Artwork - Loop Optimizer</title>
    <style>
        body { background-color: #1a1a1a; color: #00ff00; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; }
        .dashboard { display: flex; gap: 20px; margin: 20px; background: #2a2a2a; padding: 20px; border-radius: 12px; }
        canvas { background-color: #001a00; border: 2px solid #555; }
        .control-panel { width: 320px; }
        .status-box { background: #111; padding: 15px; margin-top: 10px; border-left: 4px solid #ffcc00; font-size: 0.85rem; line-height: 1.5; }
        select, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button { background: #cc6600; color: white; border: none; }
        .layer-indicator { display: flex; gap: 10px; font-size: 0.8rem; margin-bottom: 10px; }
        .red { color: #ff3333; } .blue { color: #3333ff; }
    </style>
</head>
<body>

    <h2>PCB Closed-Loop Design Expert</h2>

    <div class="dashboard">
        <div class="control-panel">
            <div class="layer-indicator">
                <span class="red">■ Top (Signal)</span>
                <span class="blue">■ Bottom (Return)</span>
            </div>
            <label>설계 레이어 선택:</label>
            <select id="layerSelect">
                <option value="1">1 Layer (같은 층에서 귀로 형성)</option>
                <option value="2" selected>2 Layers (바닥면 전체 귀로 활용)</option>
            </select>
            <button onclick="generateArtwork()">폐루프 배선 생성</button>
            
            <div id="statusBox" class="status-box">
                전문가 진단: 대기 중...
            </div>
        </div>

        <canvas id="pcbCanvas" width="600" height="400"></canvas>
    </div>

<script>
    const canvas = document.getElementById('pcbCanvas');
    const ctx = canvas.getContext('2d');
    const COLORS = { top: '#ff3333', bottom: '#4444ff', pad: '#ffcc00', silk: '#ffffff', board: '#002200' };

    function init() {
        ctx.fillStyle = COLORS.board;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        drawGrid();
    }

    function drawGrid() {
        ctx.strokeStyle = "#003300";
        for(let i=0; i<canvas.width; i+=25) {
            ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,400); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(600,i); ctx.stroke();
        }
    }

    function drawPad(x, y, label) {
        ctx.fillStyle = COLORS.pad;
        ctx.fillRect(x-10, y-10, 20, 20);
        ctx.fillStyle = COLORS.silk;
        ctx.font = "10px Arial";
        ctx.fillText(label, x-15, y-15);
    }

    function generateArtwork() {
        init();
        const layers = parseInt(document.getElementById('layerSelect').value);
        const status = document.getElementById('statusBox');

        // 부품 좌표 정의 (직렬 구성)
        const J1_VCC = {x: 100, y: 150};
        const J1_GND = {x: 100, y: 250};
        const R1_IN = {x: 250, y: 150};
        const R1_OUT = {x: 300, y: 150};
        const LED_A = {x: 450, y: 150};
        const LED_K = {x: 500, y: 150};

        // 1. 부품 배치 (Placement)
        drawPad(J1_VCC.x, J1_VCC.y, "VCC");
        drawPad(J1_GND.x, J1_GND.y, "GND");
        drawPad(R1_IN.x, R1_IN.y, "R-IN");
        drawPad(R1_OUT.x, R1_OUT.y, "R-OUT");
        drawPad(LED_A.x, LED_A.y, "LED-A");
        drawPad(LED_K.x, LED_K.y, "LED-K");

        // 2. 전진 배선 (Forward Path - Top Layer)
        ctx.strokeStyle = COLORS.top;
        ctx.lineWidth = 6;
        ctx.lineJoin = "round";
        ctx.beginPath();
        ctx.moveTo(J1_VCC.x, J1_VCC.y);
        ctx.lineTo(R1_IN.x, R1_IN.y);
        ctx.moveTo(R1_OUT.x, R1_OUT.y);
        ctx.lineTo(LED_A.x, LED_A.y);
        ctx.stroke();

        // 3. 귀로 배선 (Return Path - Loop Closure)
        if(layers === 1) {
            status.innerHTML = "<strong>[1층 진단]</strong> 배선이 겹치지 않게 우회 경로를 형성합니다. 루프 면적이 넓어 EMI에 취약할 수 있습니다.";
            ctx.strokeStyle = COLORS.top;
            ctx.beginPath();
            ctx.moveTo(LED_K.x, LED_K.y);
            ctx.lineTo(550, 150);
            ctx.lineTo(550, 320); // 보드 외곽으로 우회
            ctx.lineTo(100, 320);
            ctx.lineTo(J1_GND.x, J1_GND.y);
            ctx.stroke();
        } else {
            status.innerHTML = "<strong>[2층 진단]</strong> Via를 통해 Bottom Layer로 즉시 복귀합니다. 공급선 바로 아래로 귀로를 배치하여 <b>Loop Area를 최소화</b>합니다.";
            
            // Via 표현 (LED-K 지점)
            ctx.fillStyle = "#fff";
            ctx.beginPath(); ctx.arc(LED_K.x, LED_K.y, 8, 0, Math.PI*2); ctx.fill();
            
            // Bottom Trace (Blue)
            ctx.strokeStyle = COLORS.bottom;
            ctx.beginPath();
            ctx.moveTo(LED_K.x, LED_K.y);
            ctx.lineTo(LED_K.x, 250);
            ctx.lineTo(J1_GND.x, J1_GND.y);
            ctx.stroke();

            // Via 표현 (J1-GND 지점)
            ctx.beginPath(); ctx.arc(J1_GND.x, J1_GND.y, 8, 0, Math.PI*2); ctx.fill();
        }
    }

    window.onload = init;
</script>
</body>
</html>
